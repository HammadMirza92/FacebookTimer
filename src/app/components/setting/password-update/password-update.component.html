<!-- password-update.component.html -->
<div class="password-update-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Password Update</h1>
      <p class="page-subtitle">Change your account password to keep your account secure</p>
    </div>
  </div>

  <!-- Password Update Form -->
  <div class="password-form-card">
    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="password-form" novalidate>

      <!-- Current Password Field -->
      <div class="form-group">
        <label class="form-label">Current Password</label>
        <mat-form-field appearance="outline" class="password-field">
          <input
            matInput
            formControlName="currentPassword"
            [type]="hideCurrentPassword ? 'password' : 'text'"
            placeholder="Enter your current password"
            autocomplete="current-password"
            [class.mat-input-invalid]="f['currentPassword'].invalid && f['currentPassword'].touched">
          <button
            mat-icon-button
            matSuffix
            (click)="hideCurrentPassword = !hideCurrentPassword"
            type="button"
            [attr.aria-label]="hideCurrentPassword ? 'Show password' : 'Hide password'"
            tabindex="-1">
            <mat-icon>{{ hideCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="f['currentPassword'].errors?.['required'] && f['currentPassword'].touched">
            Current password is required
          </mat-error>
        </mat-form-field>
      </div>

      <!-- New Password Field -->
      <div class="form-group">
        <label class="form-label">New Password</label>
        <mat-form-field appearance="outline" class="password-field">
          <input
            matInput
            formControlName="newPassword"
            [type]="hideNewPassword ? 'password' : 'text'"
            placeholder="Create a strong password"
            autocomplete="new-password"
            [class.mat-input-invalid]="f['newPassword'].invalid && f['newPassword'].touched">
          <button
            mat-icon-button
            matSuffix
            (click)="hideNewPassword = !hideNewPassword"
            type="button"
            [attr.aria-label]="hideNewPassword ? 'Show password' : 'Hide password'"
            tabindex="-1">
            <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="f['newPassword'].errors?.['required'] && f['newPassword'].touched">
            New password is required
          </mat-error>
          <mat-error *ngIf="f['newPassword'].errors?.['minlength'] && f['newPassword'].touched">
            Password must be at least 8 characters long
          </mat-error>
          <mat-error *ngIf="f['newPassword'].errors?.['passwordStrength'] && f['newPassword'].touched">
            Password must contain uppercase, lowercase, number and special character
          </mat-error>
        </mat-form-field>

        <!-- Password Strength Indicator -->
        <div class="password-strength" *ngIf="f['newPassword'].value && f['newPassword'].touched">
          <div class="strength-indicator">
            <div class="strength-bar">
              <div class="strength-fill" [class]="getPasswordStrengthClass()"></div>
            </div>
            <div class="strength-text">
              Password strength: <span [class]="getPasswordStrengthClass()">{{ getPasswordStrengthText() }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Confirm New Password Field -->
      <div class="form-group">
        <label class="form-label">Confirm New Password</label>
        <mat-form-field appearance="outline" class="password-field">
          <input
            matInput
            formControlName="confirmNewPassword"
            [type]="hideConfirmPassword ? 'password' : 'text'"
            placeholder="Confirm your new password"
            autocomplete="new-password"
            [class.mat-input-invalid]="f['confirmNewPassword'].invalid && f['confirmNewPassword'].touched">
          <button
            mat-icon-button
            matSuffix
            (click)="hideConfirmPassword = !hideConfirmPassword"
            type="button"
            [attr.aria-label]="hideConfirmPassword ? 'Show password' : 'Hide password'"
            tabindex="-1">
            <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="f['confirmNewPassword'].errors?.['required'] && f['confirmNewPassword'].touched">
            Password confirmation is required
          </mat-error>
          <mat-error *ngIf="f['confirmNewPassword'].errors?.['passwordMismatch'] && f['confirmNewPassword'].touched">
            Passwords do not match
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Password Requirements -->
      <div class="password-requirements" *ngIf="f['newPassword'].value">
        <h4 class="requirements-title">Password Requirements:</h4>
        <div class="requirements-list">
          <div class="requirement-item" [class.met]="passwordValidation.hasLength">
            <mat-icon class="requirement-icon">{{ passwordValidation.hasLength ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
            <span>At least 8 characters long</span>
          </div>
          <div class="requirement-item" [class.met]="passwordValidation.hasUpper">
            <mat-icon class="requirement-icon">{{ passwordValidation.hasUpper ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
            <span>Contains uppercase letter</span>
          </div>
          <div class="requirement-item" [class.met]="passwordValidation.hasLower">
            <mat-icon class="requirement-icon">{{ passwordValidation.hasLower ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
            <span>Contains lowercase letter</span>
          </div>
          <div class="requirement-item" [class.met]="passwordValidation.hasNumber">
            <mat-icon class="requirement-icon">{{ passwordValidation.hasNumber ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
            <span>Contains number</span>
          </div>
          <div class="requirement-item" [class.met]="passwordValidation.hasSpecial">
            <mat-icon class="requirement-icon">{{ passwordValidation.hasSpecial ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
            <span>Contains special character</span>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="update-btn"
          [disabled]="!passwordForm.valid || loading">
          <div class="btn-content">
            <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
            <mat-icon *ngIf="!loading">lock_reset</mat-icon>
            <span *ngIf="!loading">Update Password</span>
            <span *ngIf="loading">Updating...</span>
          </div>
        </button>

        <button
          mat-button
          type="button"
          class="cancel-btn"
          (click)="onCancel()"
          [disabled]="loading">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Security Tips -->
  <div class="security-tips-card">
    <div class="tips-header">
      <mat-icon class="tips-icon">info</mat-icon>
      <h3 class="tips-title">Keep your account secure</h3>
    </div>

    <div class="tips-content">
      <ul class="tips-list">
        <li>Use a unique password for this account</li>
        <li>Change your password regularly</li>
        <li>Never share your password with others</li>
        <li>Log out from shared devices</li>
      </ul>
    </div>
  </div>

  <!-- Recent Password Changes -->
  <div class="password-history-card" *ngIf="passwordHistory.length > 0">
    <h3 class="history-title">Recent Password Changes</h3>
    <div class="history-list">
      <div class="history-item" *ngFor="let change of passwordHistory">
        <div class="history-icon">
          <mat-icon>lock_clock</mat-icon>
        </div>
        <div class="history-details">
          <div class="history-date">{{ change.date | date:'medium' }}</div>
          <div class="history-info">{{ change.description }}</div>
        </div>
        <div class="history-status">
          <mat-icon [class]="change.success ? 'success' : 'error'">
            {{ change.success ? 'check_circle' : 'error' }}
          </mat-icon>
        </div>
      </div>
    </div>
  </div>
</div>
